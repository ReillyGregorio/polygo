<!DOCTYPE html>
<html>

<head>
    <title>My Application</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=egde,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/res/bower_components/webcomponentsjs/webcomponents-lite.min.js" type="text/javascript" charset="utf-8"></script>
    <link href="/res/vul/elements.html" rel="import" />
    <style type="text/css">
    body {
        margin: 0px;
        padding: 0px;
        display: grid;
        grid-template-rows: 50px .90fr;
        grid-template-columns: 172px 1fr 1fr;
        grid-template-areas: "title title  title" 
                             "classes calendar calendar";
        height: 100vh;
    }

    title-element {
        grid-area: title;
    }

    classes-element {
        grid-area: classes;
        padding-top: 35px;
        padding-left: 5px;
    }

    calendar-element {
        border-left:solid black 1px;
        margin-left: 20px;
        padding-top: 20px;
        overflow-y: auto;
        grid-area: calendar;
        height: 93vh;
    }
    </style>
</head>

<body>
    <calendar-element id="calendar"></calendar-element>
    <title-element></title-element>
    <classes-element id="classes"></classes-element>
    <script type="text/javascript">
    fetch("/classes").then(function(response) {
        if (response.ok) {
            return response.json();
        }
        throw new Error("Network error");
    }).then(function(json) {
        document.getElementById("classes").periods = json;
    })

    fetch("/chat").then(function(response) {
        if (response.ok) {
            return response.json();
        }
        throw new Error("Network error");
    }).then(function(json) {
        document.getElementById("chat").messages = json;
    })

    fetch("/calendar").then(function(response) {
        if (response.ok) {
            return response.json();
        }
        throw new Error("Network error");
    }).then(function(json) {
        document.getElementById("calendar").events = json;
    })
    </script>
    <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
    <script>
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyAaF4myVt3fnXKdg5auDidDR5nJmaXB5cY",
        authDomain: "gradproject-7b11f.firebaseapp.com",
        databaseURL: "https://gradproject-7b11f.firebaseio.com",
        projectId: "gradproject-7b11f",
        storageBucket: "",
        messagingSenderId: "178157615439"
    };
    firebase.initializeApp(config);
    var provider = new firebase.auth.GoogleAuthProvider();
    provider.addScope('https://www.googleapis.com/auth/contacts.readonly');
    firebase.auth().signInWithPopup(provider).then(function(result) {
        firebase.auth().currentUser.getIdToken(false).then(function(idToken) {
          document._token = idToken;
            fetch("/verify", {
                method: "POST",
                body: idToken
            });
        })
        // This gives you a Google Access Token. You can use it to access the Google API.
        var token = result.credential.accessToken;
        // The signed-in user info.
        var user = result.user;
        document._user = user;


    }).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // The email of the user's account used.
        var email = error.email;
        // The firebase.auth.AuthCredential type that was used.
        var credential = error.credential;
        // ...
    });
    </script>
</body>

</html>